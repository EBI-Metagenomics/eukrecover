/*
    ~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~
     Config to store cluster specific execution params.
     For modules:
     - cpu
     - memory
     - env
     - time
     (publishDir options and arguments are in modules.config)
    ~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~
*/

params {
    outdir = "results"
    workdir = "/hps/nobackup/rdf/metagenomics/service-team/nextflow-workdir/users/mbc/genomes-generation"
    singularity_cachedir = "/hps/nobackup/rdf/metagenomics/service-team/singularity-cache/"
}

workDir = params.workdir

executor {
    name = "slurm"
    queueSize = 200
    queueGlobalStatus = true
}
        
process {
    queue = 'standard'
    cache = "lenient"

    cpus   = 1
    memory = 6.GB
    time   = 4.h

    errorStrategy = { task.exitStatus in ((130..145) + 104) ? 'retry' : 'finish' }
    maxRetries    = 1
    maxErrors     = '-1'
}

conda.enabled = false

singularity {
   enabled = true
   autoMounts = true
   cacheDir = params.singularity_cachedir
   registry = 'quay.io'
}

process {
    errorStrategy = { task.attempt <= 1 ? 'retry' : 'finish' }
    maxRetries = 3

    queue = 'production'
    time = '1d'
    withLabel: process_bigmem {
        queue = 'bigmem'
        time = '5d'
    }

    withName: ALIGNMENT {
        cpus = 16
        memory = '50.0 GB'
    }
    withName: ALIGNMENT_WITH_INDEXING {
        cpus = 16
        memory = '50.0 GB'
    }
    withName: ALIGNMENT_META {
        cpus = 16
        memory = '10.0 GB'
    }
    withName: BAM_TO_FASTQ {
        cpus = 16
        memory = '5.0 GB'
    }
    withName: BUSCO {
        cpus = 4
        memory = '30.0 GB'
    }
    withName: CAT {
        cpus = 8
        memory = '20.0 GB'
    }
    withName: CHECKM2 {
        cpus = 8;
        memory = '150.0 GB';
    }
    withName: CHANGE_DOT_TO_UNDERSCORE {
        cpus = 8
        memory = '2.0 GB'
    }
    withName: ERZ_TO_ERR {
        cpus = 8
        memory = '2.0 GB'
    }
    withName: CHANGE_UNDERSCORE_TO_DOT {
        cpus = 8
        memory = '2.0 GB'
    }
    withName: "CONCOCT_.*" {
        cpus = 8
        memory = '30.0 GB'
    }
    withName: CONCOCT_CUTUPFASTA {
        cpus = 2
        memory = '1.0 GB'
    }
    withName: CONCOCT_CONCOCT {
        cpus = 8
        memory = '30.0 GB'
    }
    withName: COVERAGE_RECYCLER {
        cpus = 1
        memory = '2.0 GB'
    }
    withName: DETECT_CONTAMINATION {
        cpus = 1
        memory = '2.0 GB'
    }
    withName: DETECT_RRNA {
        cpus = 4
        memory = '2.0 GB'
    }
    withName: DREP {
        cpus = 32
        memory = '25.0 GB'
    }
    withName: DREP_MAGS {
        cpus = 32
        memory = '25.0 GB'
    }
    withName: EUKCC {
        cpus = 16
        memory = '20.0 GB'
    }
    withName: INDEX_FASTA {
        cpus = 16
        memory = '20.0 GB'
    }
    withName: GTDBTK {
        cpus = 32
        memory = '100.0 GB'
    }
    withName: GZIP {
        cpus = 16
        memory = '10.0 GB'
    }
    withName: GUNC {
        cpus = 4
        memory = '20.0 GB'
    }
    withName: FASTP {
        cpus = 8
        memory = '20.0 GB'
    }
    withName: LINKTABLE {
        cpus = 2
        memory = '20.0 GB'
    }
    withName: MAG_CLEANUP_CAT {
        cpus = 8
        memory = '20.0 GB'
    }
    withName: METAWRAP_BINNING {
        cpus = 8
        memory = '80.0 GB'
    }
    withName: BAT {
        cpus = 8;
        memory = '20.0 GB';
    }
    withName: METABAT2_JGISUMMARIZEBAMCONTIGDEPTHS {
        cpus = 8;
        memory = '2.0 GB';
    }
    withName: MAXBIN2 {
        cpus = 8;
        memory = '10.0 GB';
    }
    withName: RENAME_MAXBIN {
        cpus = 1
        memory = '200 MB'
    }
}
